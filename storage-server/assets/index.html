<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Storage Server</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div id="app">
      <div class="display-6 text-center">Storage Server</div>
      <p></p>

      <div class="container">
        <div class="input-group mb-3">
          <input
            accept="image/*"
            type="file"
            @change="onFileChange"
            class="form-control"
          />
          <button
            type="submit"
            value="Upload file"
            @click="uploadFile"
            class="btn btn-outline-primary"
          >
            Upload Image
          </button>
        </div>
        <p></p>

        <!-- <div class="input-group mb-3">
          <input
            type="text"
            v-model="imageid"
            class="form-control"
            placeholder="Image-ID"
            aria-label="Image-ID"
            aria-describedby="button-addon2"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            id="button-addon2"
            @click="addImage"
          >
            Search
          </button>
        </div> -->

        <div class="card" style="width: 18rem" v-for="image in images">
          <img class="card-img-top" :src="image.url" alt="Borat" />
          <div class="card-body">
            <h5 class="card-title">Borat</h5>
            <p class="card-text">#images #memes</p>

            <a :href="image.url" class="btn btn-primary">Download</a>&nbsp;
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        createApp,
        ref,
      } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";

      createApp({
        data() {
          return {
            images: [],
            imageid: "",
            selectedFile: "",
          };
        },
        methods: {
          addImage() {
            this.images.push({
              url: "/api/v1/storage/" + this.imageid,
            });
          },
          async onFileChange(e) {
            this.selectedFile = e.target.files[0];
            console.log("selected file", this.selectedFile);
          },
          async uploadFile() {
            const formData = new FormData();
            formData.append("file", this.selectedFile);

            try {
              const response = await axios.post("/api/v1/storage", formData, {
                headers: {
                  "Content-Type": "multipart/form-data",
                },
              });
              console.log(response);

              this.images.push({
                url: "/api/v1/storage/" + response.data,
              });
            } catch (error) {
              console.error(error);
            }
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
